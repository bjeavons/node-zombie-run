<!DOCTYPE html>
<html>
<head>
  <title>Zombiez!</title>
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a3/jquery.mobile-1.0a3.min.css" />
  <style type="text/css">
    #map { height: 500px; width: 100% }
  </style>
</head>
<body>
  <!--div id="create" data-role="page">
  	<div data-role="header">
  		<h1>Zombiez</h1>
  	</div>
  	<div data-role="content">	
      <div data-role="fieldcontain">
        <label for="user">Your name</label>
        <input type="text" name="user" id="user" value="" />
        
        <label for="name">Name your party</label>
        <input type="text" name="name" id="name" value="" />
        
        <label for="type" class="select">Zombie type</label>
        <select name="type" id="type">
          <option value="3">Night of the Living Dead</option>
          <option value="5">Resident Evil</option>
          <option value="10">28 Days Later</option>
        </select>
        
        <label for="outbreak" class="select">Outreak</label>
        <select name="outbreak" id="outbreak">
          <option value="early">Early infestation</option>
          <option value="late">Late infestation</option>
          <option value="pandemic">Pandemic</option>
        </select>
      </div>
      <div data-role="fieldcontain">
        <input type="submit" name="start" id="start" value="Go!" />
      </div>
  	</div>
  	<div data-role="footer">
  		<h4>&copy; ur brainz</h4>
  	</div>
  </div-->
  
  <div id="game" data-role="page">
  	<div data-role="header">
  		<h1>Loading</h1>
  	</div>
  	<div data-role="content">	
      <div id="map"></div>
  	</div>
  	<div data-role="footer">
  		<h4>&copy; ur brainz</h4>
  	</div>
  </div>
  
  <script src="http://code.jquery.com/jquery-1.5.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.0a3/jquery.mobile-1.0a3.min.js"></script>
  <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script src="scripts/socket.io.js"></script>
  <script src="scripts/map.js"></script>
  <script type="text/javascript">
    var GAME = 'test';
    
    var socket = new io.Socket('127.0.0.1', {port: 8124});
    var map = new Map('#map');
    
    socket.on('message', function(data) {
      switch (data.action) {
        case 'update': map.update(data.state);
        default:
          console.log(data);
      }
    });
    
    socket.on('disconnect', function(){
      console.log('fffuuuuuuu, server disconnected');
    });
    
    socket.connect();
    
    navigator.geolocation.getCurrentPosition(function(position) {
      socket.send({
        action: 'create',
        name: GAME,
        type: 3,
        outbreak: 'late',
        lat: position.coords.latitude,
        lng: position.coords.longitude
      });
    });
    
    navigator.geolocation.watchPosition(function(position) {
      map.center(position.coords.latitude, position.coords.longitude);
      socket.send({ 
        action: 'ping', 
        game: GAME, 
        lat: position.coords.latitude, 
        lng: position.coords.longitude 
      });
    }, function() {
      console.log('fffuuuuuuu, error getting position');
    });
    
  </script>
</body>
</html>